<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>잔디 달력 샘플</title>
  <style>
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 16px);
      grid-auto-rows: 16px;
      gap: 2px;
      background: #eee;
      padding: 10px;
      width: max-content;
    }
    .cell {
      width: 16px;
      height: 16px;
      border-radius: 3px;
      box-sizing: border-box;
      border: 1px solid #ddd;
      transition: background 0.2s;
    }
    .cell:hover {
      border: 1px solid #333;
    }
    .user-color {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h2>잔디 달력 샘플 (OKLAB 색상 선택)</h2>
  <div class="user-color">
    <label>L(밝기): <input type="range" id="LSlider" min="0" max="1" step="0.01" value="0.8"></label>
    <label>a(녹색~빨강): <input type="range" id="aSlider" min="-1" max="1" step="0.01" value="0.1"></label>
    <label>b(파랑~노랑): <input type="range" id="bSlider" min="-1" max="1" step="0.01" value="0.1"></label>
    <span id="colorPreview" style="display:inline-block;width:24px;height:24px;vertical-align:middle;border:1px solid #aaa;margin-left:8px;"></span>
    <div style="margin-top:8px;">
      대표 색상:
      <button type="button" id="btnGreen">녹색</button>
      <button type="button" id="btnRed">빨강</button>
      <button type="button" id="btnBlue">파랑</button>
      <button type="button" id="btnYellow">노랑</button>
    </div>
  </div>
  <div class="calendar" id="calendar"></div>
  <script src="oklab.js"></script>
  <script>
    // 샘플 커밋 데이터 (30일)
    const commitData = Array.from({length: 30}, () => Math.floor(Math.random()*5));
    const maxCommit = Math.max(...commitData);

    // OKLAB 슬라이더 값
    let L = parseFloat(document.getElementById('LSlider').value);
    let a = parseFloat(document.getElementById('aSlider').value);
    let b = parseFloat(document.getElementById('bSlider').value);

    // 대표 색상 버튼 클릭 시 OKLAB 값 변경
    document.getElementById('btnGreen').onclick = function() {
      L = 0.8; a = -0.4; b = 0.2;
      document.getElementById('LSlider').value = L;
      document.getElementById('aSlider').value = a;
      document.getElementById('bSlider').value = b;
      renderCalendar();
    };
    document.getElementById('btnRed').onclick = function() {
      L = 0.7; a = 0.4; b = 0.2;
      document.getElementById('LSlider').value = L;
      document.getElementById('aSlider').value = a;
      document.getElementById('bSlider').value = b;
      renderCalendar();
    };
    document.getElementById('btnBlue').onclick = function() {
      L = 0.6; a = 0.0; b = -0.4;
      document.getElementById('LSlider').value = L;
      document.getElementById('aSlider').value = a;
      document.getElementById('bSlider').value = b;
      renderCalendar();
    };
    document.getElementById('btnYellow').onclick = function() {
      L = 0.9; a = -0.1; b = 0.5;
      document.getElementById('LSlider').value = L;
      document.getElementById('aSlider').value = a;
      document.getElementById('bSlider').value = b;
      renderCalendar();
    };

    // OKLAB -> RGB 변환
    function oklabToHex(L, a, b) {
      const rgb = window.oklabToRgb(L, a, b);
      return '#' + [rgb.r, rgb.g, rgb.b].map(x => x.toString(16).padStart(2, '0')).join('');
    }

    // 잔디 칸 생성 함수
    function renderCalendar() {
      const cal = document.getElementById('calendar');
      cal.innerHTML = '';
      for(let i=0; i<commitData.length; i++) {
        const intensity = commitData[i] / (maxCommit || 1); // 0~1
        
        // 채도 기반 진하기 조절
        const baseChroma = Math.sqrt(a*a + b*b); // 현재 채도
        const chromaMultiplier = 0.3 + 0.7 * intensity; // 0.3~1.0
        const lightnessMultiplier = 0.4 + 0.6 * intensity; // 0.4~1.0
        
        // 새로운 a, b, L 값 계산
        const newA = a * chromaMultiplier;
        const newB = b * chromaMultiplier;
        const newL = L * lightnessMultiplier;
        
        const color = oklabToHex(newL, newA, newB);
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.style.background = color;
        cell.title = `${i+1}일: ${commitData[i]}회`;
        cal.appendChild(cell);
      }
      // 미리보기 색상
      document.getElementById('colorPreview').style.background = oklabToHex(L, a, b);
    }

    // 슬라이더 이벤트
    document.getElementById('LSlider').addEventListener('input', e => {
      L = parseFloat(e.target.value);
      renderCalendar();
    });
    document.getElementById('aSlider').addEventListener('input', e => {
      a = parseFloat(e.target.value);
      renderCalendar();
    });
    document.getElementById('bSlider').addEventListener('input', e => {
      b = parseFloat(e.target.value);
      renderCalendar();
    });

    // 최초 렌더링
    renderCalendar();
  </script>
</body>
</html>
